name: Release lib

on:
  workflow_call:
    secrets:
      node-auth-token:
        required: true
        description: The token to authenticate NPM

jobs:
  continuous-integration:
    name: Continuous integration
    uses: ./.github/workflows/continuous-integration.yml
    secrets:
      node-auth-token: ${{ secrets.NODE_AUTH_TOKEN }}

  continuous-delivery:
    name: Continuous delivery
    needs: continuous-integration
    runs-on: ubuntu-latest
    steps:
      - name: Download build outputs
        uses: actions/download-artifact@v5
        with:
          artifact-ids: ${{ needs.continuous-integration.outputs.artifact-id }}

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          cache: npm
          node-version: 22.16

      - name: Publish
        run: npm publish
        shell: bash
        env:
          NODE_AUTH_TOKEN: ${{ secrets.node-auth-token }}
